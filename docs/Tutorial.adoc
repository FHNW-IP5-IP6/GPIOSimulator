:toc: left
//:toc: macro
:toc-title:
:toclevels: 5
:sectnums:
:sectnumlevels: 5
:sourcedir: ../src/main/java
:imagesdir: ./assets/images
:iconsdir: ./icons
:stylesdir: ./styles
:homepage: https://github.com/FHNW-IP5-IP6/GPIOSimulator

image::FHNW.png[FHNW,382,59]
[discrete]
= IP5: FHNW Pi4J Tutorial

*Autoren*:

* Herr Jonathan Bättig (jonathan.baettig@students.fhnw.ch) 
* Herr Anessollah Ima (anessollah.ima@students.fhnw.ch)

*FHNW* +
*Hochschule für Technik* +
*Studiengang* : Informatik +
*Semester* : 6BB

*Betreuende Dozenten*:

* Frau Dr. Barbara Scheuner (barbara.scheuner@fhnw.ch) 
* Herr Dr. Dieter Holz (dieter.holz@fhnw.ch) 

*Datum*: {docdate}

<<<
[discrete]
== Inhaltsverzeichnis
toc::[]

<<<
:sectnums!:
== Einleitung
:sectnums:

<<<

== Unterstützte Hardware und Software
=== Hardware

=== Software

==== Pi4J

==== Java

== Setup des RaspberryPi

=== Installation von Raspbian 
Als erstes benötigen Sie das Betriebssystem Raspbian, welches später auf die Mini SD-Karte aufgesetzt wird.

Dafür müssen Sie sich das Image downloaden. Besuchen Sie hierfür die Download-Website der Raspberry Organisation: + 
https://www.raspberrypi.org/downloads/raspbian/

._Raspbian Download_
image::./installation/raspbianDownload.png[balenaEtcher Download]


Wählen Sie jetzt `Raspbian Buster with desktop` aus. Downloaden und extrahieren Sie den Zip-Ordner. Dieser Ordner enthält die img-Datei, die danach benötigt wird für die Installation.

Um OS Images auf SD-Karten oder USB-Sticks installieren zu können, brauchen Sie eine Disk Imaging Software.
Wir empfehlen dafür balenaEtcher, aber es gibt auch andere gute Software.

Downloaden und installieren Sie balenaEtcher von der balena Homepage: + 
https://www.balena.io/etcher/

._balenaEtcher Download_
image::./installation/balenaDownload.png[width=70% balenaEtcher Download]

Starten Sie nach dem Download balenaEtcher.
Sie können das Image jetzt in 3 einfachen Schritten aufsetzen.

._balenaEtcher Startbildschirm_
image::./installation/balenaStart.png[width=70% balenaEtcher Startbildschirm]

. Wählen Sie zuerst das Image aus, welches Sie vorher gedownloaded haben
. Wählen Sie danach die Mini SD-Karte aus, welche Sie an ihren PC angeschlossen haben. Bitte beachten Sie, dass die SD-Karte formatiert wird und alle Daten darauf gelöscht werden.
. Klicken Sie dann auf "Flash!" und warten Sie bis balenaEtcher fertig ist mit der image installation.

Wenn Sie die zusätzliche Hardware besitzen, um den Pi als normalen Rechner zu verwenden (Maus, Monitor und Tastatur), dann können Sie jetzt die Mini SD-Karte an den Pi anschliessen und den Pi starten.

Die Standard Credentials für den Login auf dem Pi sind:

* *User*: pi +
* *Passwort*: raspberry

=== Nutzung ohne zusätzliche Hardware
Da zusätzliche Hardware nicht immer zur Verfügung steht und die bequemen Entwicklungsumgebungen, auf die man nicht mehr verzichten möchte, zu hohe Systemanforderungen an den Raspberry Pi stellen, erkären wir hier, wie man mit dem Pi arbeiten kann, wenn man es nur mit dem USB-Kabel an den Laptop anschliesst.

Zuerst benötigen Sie die Software PuTTY, um auf den Pi zu zugreifen. Sie können es downloaden über den folgenden Link: + 
https://www.putty.org/

==== Zugriff über SSH
Zuerst müssen Sie wieder die SD-Karte an den PC anschliessen und normal auf den boot Folder zugreifen zu können.

Jetzt müssen Sie verschieden Einstellungen direkt an den markierten Files in diesem Ordner vornehmen:

._boot Ordner_
image::./installation/bootFolder.png[width=70% boot Ordner]

* Im File `config.txt` müssen Sie ganz am Schluss den Folgenden Snippet hinzufügen +
[source]
----
dtoverlay=dwc2
----

* Im File `cmdline.txt` müssen Sie nach dem Text "rootwait" suchen und danach den folgenden snippet hinzufügen +
[source]
----
modules-load=dwc2,g_ether
----

Das sieht dann z. B so aus 

._cmdLine File_
image::./installation/cmdLine.png[width=70% cmdLine file]


Jetzt müssen Sie ein leeres File ohne Dateiendung erstellen, und dieses ssh nennen. Hierfür kann man z. B ein Textfile erstellen und dann die Endung entfernen:

._SSH aktivieren_
image::./installation/activateSSH.png[width=70% activate SSH]

Schliessen Sie die Mini SD-Karte wieder an den RaspberryPi an und schliessen Sie danach den Raspberry Pi mit dem USB-Kabel an den Laptop an.

Danach können Sie PuTTY starten und mit der folgenden Konfiguration auf den Pi zugreifen.

._SSH Zugriff mit PuTTY_
image::./installation/SSHputty.png[width=60% SSH Zugriff]

Jetzt können Sie sich mit den Standard Credentials anmelden und den Raspberry Pi über die Konsole verwenden.

._Login in PuTTY_
image::./installation/puttyLogin.png[width=70% Login in PuTTY]


==== Zugriff über Wifi
Wenn Sie sich im selben Netzwerk befinden, wie das Raspberry Pi, dann können Sie auch über das Netz auf den Pi zugreifen.
Damit der Pi auf das WLAN zugreifen kann, müssen Sie wieder die SD-Karte an Ihren Laptop anschliessen und eine Datei im boot Ordner erstellen: Das `wpa_supplicant.conf` file:

[source]
----
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=US

network={
    ssid="NETZWERK"
    psk="PASSWORT"
}
----

Bei `ssid` müssen Sie den Netzwerknamen angeben und bei `psk` das Passwort.
Schliessen sie die SD-Karte wieder an den Raspberry Pi und den Pi wieder an den Laptop.

Jetzt können Sie in PuTTY die IP-Adresse eingeben und sich somit verbinden.

Sie können ihre IP-Addresse auch über den folgenden Befehl `hostname -I` im Raspberry Pi finden, falls sie die Verbindung über SSH bereits gemacht haben.

==== VNC Viewer anstatt Monitor
Um ohne Monitor das Grafische Interface von Raspbian verwenden zu können, kann man die VNC Funktionalitäten des Raspberry Pi verwenden.

Zuerst muss man einen VNC auf dem Raspberry Pi aktivieren:

`sudo raspi-config`, dann `Interfacing Options`, dann auf `VNC` und die Auswahl bestätigen.

Dann muss man einen VNC Viewer auf dem eigenen Rechner installieren. Wie z. B den Real VNC Viewer: + 

https://www.realvnc.com/de/connect/download/viewer/

Diesen kann man dan starten und die IP Addresse des Raspberry Pis eingeben, um den Remotezugriff auf den Pi aufzubauen:

._VNC Viewer Zugriff auf Pi_
image::./installation/VNCViewer.png[width=70% VNC Viewer Zugriff auf Pi]

Jetzt sieht man auch die GUI von Raspbian mit dem Remotezugriff von VNC:

._VNC Viewer GUI von Raspbian_
image::./installation/VNCViewerGUI.png[width=70% VNC Viewer GUI von Raspbian]

Es kann gut sein, dass die Auflösung und die Grösse der Icons nicht optimal ist.
Dies können Sie wie folgt einstellen:

* *Auflösung*: + 
    _Preferences -> Raspberry Pi Configuration -> Display_ +
    Hier können Sie  die Unter "Set Resolution" die Auflösung veränder. Es kann auch sein, dass die _"Underscan"_ deaktiviert werden muss, weil sie eventuell ihre Einstellungen zur Auflösung überschreibt.

* *Icon Grösse*: + 
    _Preferences -> Appearance Settings -> System -> Defaults_ + 
    Hier können Sie die Grösse verändern, je nach Grösse Ihres Geräts.


=== Installation von zusätzlicher Software auf dem Pi

==== Deployment auf dem Pi

== Beispiele
In diesem Kapitel finden sie alle Sensoren und Aktoren mit Verkabelung und Code Beispielen. Für die Code Beispiele werden jeweils gewisse Vorkenntnisse erwartet, die wir hier in Levels eingeteilt haben:

* *Level 1: Basic*
    ** Variablen und Berechnungen: primitive Datentypen, Wertebereiche und deren Auswirkung beim Rechnen
    ** Methoden und Parameter: Deklaration, Aufruf, Signatur, Argumente und Rückgabewert
    ** Kontrollstrukturen: Schleifen und Fallunterscheidungen
    ** Grundlagen Klassen, Objekte und Vererbung: Deklaration, Instanziierung von Klassen, Überladen und Überschreiben von Methoden, Vererbung, Polymorphie
* *Level 2: Intermediate*
    ** Verwendung grundlegender Datenstrukturen (List, Map, Set) und Iteratoren
    ** Generics und ihre Besonderheiten in Java
    ** Event Handling
    ** Collection-Streams und Lambda-Ausdrücke

* *Level 3: Advanced*
    ** Nebenläufigkeit mit Threads
    Strukturierung von Applikationen
    ** Daten-Persistenz (File-Handling, Serialisierung)

=== LED

==== Verkabelung

Für die Verkabelung wird folgende Hardware benötigt:

* 2x Kabel
* 1x LED
* 1x 220Ω Wiederstand


.LED Verkabelung 
image::./fritzing/blink_led.png[width=100% LED Wiring]

==== Code Beispiel

In diesem Beispiel wird einfach eine LED blinken gelassen mit einem delay von einer Sekunde. +
*Vorkenntnisse: Basic*
[source,java]
----
include::{sourcedir}/fhnwexamples/gpio/BlinkLed.java[tags=BlinkLed]
----

=== Button
==== Verkabelung

Für die Verkabelung wird folgende Hardware benötigt:

* 4x Kabel
* 1x Button
* 1x 220Ω Wiederstand


.Button Verkabelung 
image::./fritzing/button_click.png[Button Wiring]

==== Code Beispiel

In diesem Beispiel wird jeder Klick auf dem Button in der Konsole angezeigt +
*Vorkenntnisse: Basic*
[source,java]
----
include::{sourcedir}/fhnwexamples/gpio/ButtonClick.java[tags=ButtonClick]
----
=== LCD

=== LCD I2C
==== Verkabelung
Für die Verkabelung wird folgende Hardware benötigt:

* 4x Kabel
* 1x LCD1602 I2C Modul mit PCF8574 I2C extender

.LCD I2C Modul Verkabelung 
image::./fritzing/LCDI2C.png[width=70% I2C Wiring]

==== Code Beispiel

In diesem wird der Titel des Projekts in der ersten Zeile angezeigt und die Uhrzeit in der zweiten. Die Uhrzeit wird auch jede Sekunde geupdated  +
*Vorkenntnisse: Basic*
[source,java]
----
include::{sourcedir}/fhnwexamples/component/LcdSystemTimeI2C.java[tags=LcdSystemTimeI2C]
----

=== Motor Direction

=== Motor Hardware PWM

=== Motor Software PWM

=== Serial Camera

=== Raspberry Pi Camera

==== Verkabelung
Für die Verkabelung wird folgende Hardware benötigt:

* 1x Raspberry Pi Camera mit Flachbandkabel

.Raspberry Pi Camera Verkabelung 
image::./fritzing/raspiCam.png[width=50% RaspiCam Wiring]

==== Code Beispiel
In diesem Beispiel wird die Raspberry Pi Camera mit einer externen Library verwendet.
Es werden 10 Bilder nacheinander geschossen und in den Ordner `/home/pi/Pictures/PiCamPics` gespeichert.  +
*Vorkenntnisse: Intermediate*
[source,java]
----
include::{sourcedir}/fhnwexamples/component/RaspberryPiCamera.java[tags=RaspberryPiCamera]
----


=== Servo Motor

=== Stepper Motor

<<<

:sectnums!:
== Schluss

<<<
== Literaturverzeichnis

<<<
== Ehrlichkeitserklärung

<<<
== Anhang
